<!DOCTYPE html>
<html>
<head><title>File Test</title></head>
<body>
<h1>File Persistence Test</h1>
<button onclick="test()">Test Files</button>
<div id="result"></div>
<script>
async function test() {
  const token = localStorage.getItem("visaMate_accessToken");
  if (!token) {
    document.getElementById("result").innerHTML = "Not logged in. <a href=\"/auth/signin\">Login</a>";
    return;
  }
  
  try {
    const response = await fetch("https://eybfrryonupkvjhzfwaw.supabase.co/functions/v1/make-server-54a8f580/user/files", {
      headers: { "Authorization": `Bearer ${token}` }
    });
    const data = await response.json();
    
    if (data.success) {
      document.getElementById("result").innerHTML = `<h3>Files (${data.files.length}):</h3>` + 
        data.files.map(f => `<p>${f.name} - ${f.error ? "ERROR" : "OK"}</p>`).join("");
    } else {
      document.getElementById("result").innerHTML = "Error: " + data.error;
    }
  } catch (e) {
    document.getElementById("result").innerHTML = "Error: " + e.message;
  }
}
</script>
</body>
</html>
